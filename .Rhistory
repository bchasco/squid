,
hessian=TRUE,
map=myMap,
DLL="squid2")
# Check_Identifiable(Obj)
out <- nlminb(Obj$par,Obj$fn,Obj$gr)
rep <- Obj$report()
parNames <- c("sig_s",
"sig_tr",
"sig_y",
"sig_yt",
"rho_tr",
"rho_y",
"rho_yt_1",
"rho_yt_2",
"lam",
"p",
"theta")
estPars <- c(rep$sig_eps_s,
rep$sig_eps_tr,
rep$sig_eps_y,
rep$sig_eps_yt,
rep$rho_tr,
rep$rho_y,
rep$rho_yt_1,
rep$rho_yt_2,
exp(rep$ln_lam),
rep$p,
rep$theta)
estParNames <- parNames[!(parNames%in%names(estNames))]
i <- 1
if(runSim){
myMap <- list()
simNames <- list()
if(!sim_tr){
myMap <- append(myMap
,map_tr)
tmpNames <- list(sig_tr=NA,
rho_tr=NA)
simNames <- append(simNames,
tmpNames)
}
if(!sim_s){
myMap <- append(myMap
,map_s)
tmpNames <- list(sig_s=NA)
simNames <- append(simNames,
tmpNames)
}
if(!sim_y){
myMap <- append(myMap
,map_y)
tmpNames <- list(sig_y=NA,
rho_y=NA)
simNames <- append(simNames,
tmpNames)
}
if(!sim_yt){
myMap <- append(myMap
,map_yt)
tmpNames <- list(sig_yt=NA,
rho_yt_1=NA,
rho_yt_2=NA)
simNames <- append(simNames,
tmpNames)
}
simout <- replicate(nsim,{
simData <- Obj$simulate(par = Obj$env$last.par.best, complete = TRUE)
simData$est_s <- sim_s
simData$est_y <- sim_y
simData$est_tr <- sim_tr
simData$est_yt <- sim_yt
obj2 <- MakeADFun(simData,
Parameters,
random=c("eps_s", #Station
"eps_tr",#Latitude
"eps_y", #Year
"eps_yt")#Spatio-temporal
,
hessian=TRUE,
silent = TRUE,
map=myMap,
DLL="squid2")
print(i)
i <- i+1
sim_i <- nlminb(obj2$par,obj2$fn,obj2$gr)
rep <- obj2$report()
par(mfrow=c(2,2))
plot(simData$eps_tr, ylim=c(min(simData$eps_tr,rep$eps_tr),max(simData$eps_tr,rep$eps_tr)))
lines(rep$eps_tr)
plot(simData$eps_y, ylim=c(min(simData$eps_y,rep$eps_y),max(simData$eps_y,rep$eps_y)))
lines(rep$eps_y)
hist(simData$eps_s)
hist(rep$eps_s, add=TRUE, col="red")
image(rep$eps_yt)
c(rep$sig_eps_s,
rep$sig_eps_tr,
rep$sig_eps_y,
rep$sig_eps_yt,
rep$rho_tr,
rep$rho_y,
rep$rho_yt_1,
rep$rho_yt_2,
exp(rep$ln_lam),
rep$p,
rep$theta)})
row.names(simout) <- parNames
simMelt <- melt(t(simout),measure.vars = colnames(simout),variable.name="pars")
simMelt <- simMelt[!(simMelt$Var2%in%names(simNames)),]
sim_par <- unique(simMelt$Var2)
for(ii in sim_par){
dat_q <- quantile(simMelt$value[simMelt$Var2==ii], probs=c(0.025,0.975))
simMelt <- simMelt[!(simMelt$Var2==ii & (simMelt$value<dat_q[1] | simMelt$value>=dat_q[2])),]
}
library(ggplot2)
myLines <- data.frame(Var2=parNames,
value=estPars)
myLines <- myLines[!(myLines$Var2%in%names(estNames)) |
!(myLines$Var2%in%names(simNames)),]
p <- ggplot(simMelt, aes(factor(Var2),value)) +
facet_wrap(~Var2, scales = "free") +
geom_violin(aes(factor(Var2)))+
geom_hline(aes(yintercept=value), colour="blue",myLines)
print(p)
}
save(simout,
file=paste("simout",paste(est_s,est_tr,est_y,est_yt,sep="",collapse = ""),
".out",sep=""))
myMap <- list()
simNames <- list()
if(!sim_tr){
myMap <- append(myMap
,map_tr)
tmpNames <- list(sig_tr=NA,
rho_tr=NA)
simNames <- append(simNames,
tmpNames)
}
if(!sim_s){
myMap <- append(myMap
,map_s)
tmpNames <- list(sig_s=NA)
simNames <- append(simNames,
tmpNames)
}
if(!sim_y){
myMap <- append(myMap
,map_y)
tmpNames <- list(sig_y=NA,
rho_y=NA)
simNames <- append(simNames,
tmpNames)
}
if(!sim_yt){
myMap <- append(myMap
,map_yt)
tmpNames <- list(sig_yt=NA,
rho_yt_1=NA,
rho_yt_2=NA)
simNames <- append(simNames,
tmpNames)
}
simout <- replicate(nsim,{
simData <- Obj$simulate(par = Obj$env$last.par.best, complete = TRUE)
simData$est_s <- sim_s
simData$est_y <- sim_y
simData$est_tr <- sim_tr
simData$est_yt <- sim_yt
obj2 <- MakeADFun(simData,
Parameters,
random=c("eps_s", #Station
"eps_tr",#Latitude
"eps_y", #Year
"eps_yt")#Spatio-temporal
,
hessian=TRUE,
silent = TRUE,
map=myMap,
DLL="squid2")
print(i)
i <- i+1
sim_i <- nlminb(obj2$par,obj2$fn,obj2$gr)
rep <- obj2$report()
par(mfrow=c(2,2))
plot(simData$eps_tr, ylim=c(min(simData$eps_tr,rep$eps_tr),max(simData$eps_tr,rep$eps_tr)))
lines(rep$eps_tr)
plot(simData$eps_y, ylim=c(min(simData$eps_y,rep$eps_y),max(simData$eps_y,rep$eps_y)))
lines(rep$eps_y)
hist(simData$eps_s)
hist(rep$eps_s, add=TRUE, col="red")
image(rep$eps_yt)
c(rep$sig_eps_s,
rep$sig_eps_tr,
rep$sig_eps_y,
rep$sig_eps_yt,
rep$rho_tr,
rep$rho_y,
rep$rho_yt_1,
rep$rho_yt_2,
exp(rep$ln_lam),
rep$p,
rep$theta)})
row.names(simout) <- parNames
simMelt <- melt(t(simout),measure.vars = colnames(simout),variable.name="pars")
simMelt <- simMelt[!(simMelt$Var2%in%names(simNames)),]
sim_par <- unique(simMelt$Var2)
for(ii in sim_par){
dat_q <- quantile(simMelt$value[simMelt$Var2==ii], probs=c(0.025,0.975))
simMelt <- simMelt[!(simMelt$Var2==ii & (simMelt$value<dat_q[1] | simMelt$value>=dat_q[2])),]
}
library(ggplot2)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
out <- nlminb(Obj$par,Obj$fn,Obj$gr)
# Make object
Obj = MakeADFun(data=Data,
parameters=Parameters,
random=c("eps_s", #Station
"eps_tr",#Latitude
"eps_y", #Year
"eps_yt")#Spatio-temporal
,
hessian=TRUE,
map=myMap,
DLL="squid2")
Check_Identifiable(Obj)
myMap <- append(myMap,
list(fp=as.factor(NA)))
Data <- append(Data,
list(est_tr = est_tr,
est_y = est_y,
est_s = est_s,
est_yt = est_yt))
# Make object
Obj = MakeADFun(data=Data,
parameters=Parameters,
random=c("eps_s", #Station
"eps_tr",#Latitude
"eps_y", #Year
"eps_yt")#Spatio-temporal
,
hessian=TRUE,
map=myMap,
DLL="squid2")
Check_Identifiable(Obj)
# myMap <- append(myMap,
#                 list(fp=as.factor(NA)))
myMap <- append(myMap
,list(ln_lam=as.factor(NA),
ln_theta=as.factor(NA)))
Data <- append(Data,
list(est_tr = est_tr,
est_y = est_y,
est_s = est_s,
est_yt = est_yt))
# Make object
Obj = MakeADFun(data=Data,
parameters=Parameters,
random=c("eps_s", #Station
"eps_tr",#Latitude
"eps_y", #Year
"eps_yt")#Spatio-temporal
,
hessian=TRUE,
map=myMap,
DLL="squid2")
Check_Identifiable(Obj)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
rep$rho_tr
out$par
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
out$par
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
out$par
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
out$par
exp(-0.2467)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
out$par
rep <- Obj$report()
rep$rho_yt_2
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
rep$rho_yt_2
rep$rho_yt_1
atan(0)*3.154/2
atan(10)*3.154/2
atan(10)
atan(-10)
atan(-100)
atan(100)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
rep$rho_yt_2
rep$rho_yt_1
rep$rho_y
rep$rho_r
rep$rho_tr
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
rep$rho_tr
rep$rho_yt_2
rep$rho_yt_1
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
exp(-1/(-2))
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
out$par
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
out$par
exp(-1/(0.03^2))
exp(-1/(0.3^2))
exp(-0.1/(0.03^2))
exp(-0.1/(0.3^2))
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
out$par["frho_yr"]
out$par["frho_tr"]
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
sim_i$par["frho_tr"]
sim_i$par["frho_yt_2"]
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
out$par
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
out$par
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
x <- read.table("comb_catches.csv")
x <- read.table("comb_catches.csv", sep="\t")
dim(x)
x <- read.table("comb_catches.csv", sep="\t")
dim(x)
x <- read.table("comb_catches.txt", sep="\t")
dim(x)
head(x)
x <- read.table("comb_catches.txt", sep="\t", header=TRUE)
head(x)
hist(x$CPUE)
sum(x$CPUE[x$CPUE==0])
x$CPUE==0
x$CPUE[x$CPUE==0]
plot(x$Long,x$Lat)
names(x)
x$Date
x <- read.table("comb_catches.txt", sep="\t",header=TRUE)
dim(x)
x$Year <- as.numeric(as.character(x$Year))
x <- x[!is.na(x$Year),]
dim(x)
lat_index <- 1
x$TransectLat_i <- as.integer(as.factor(round(x$Lat,lat_index)))-1
table(x$TransectLat_i)
x$Lat
x$TransectLat <- round(x$Latitude,lat_index)
x$TransectLat <- round(x$Lat,lat_index)
transDist <- sort(unique(round(x$Lat,lat_index)))
names(x)
c_i <- x$CPUE
s_i <- as.integer(x$Station)-1
s_i
range(s_i)
ag <- aggregate(c_i, by=list(s_i),sum)
ag
plot(ag)
ag$s_i_re <- -1
ii <- 0
for(i in 1:nrow(ag)){
if(ag$x[i]>0){
ag$s_i_re[i] <- ii
ii <- ii +1
}
}
Data <- list(c_i = c_i,
s_i = s_i,
s_i_re = ag$s_i_re,
y_i = x$Year-min(x$Year),
transDist = transDist,
trans_i = x$TransectLat_i)
Parameters <- list(fp = -0,
ln_lam = log(300),
ln_theta = log(1),
tr_b = 0,
tr_0 = 0,
eps_s = rep(0,max(Data$s_i_re)+1),
lnsig_eps_s = 0,
eps_y = rep(0,length(unique(Data$y))),
frho_y = 1,
lnsig_eps_y = 0,
eps_tr = rep(0,length(unique(Data$trans_i))),
frho_tr = 0.1,
lnsig_eps_tr = 0,
eps_yt = matrix(0,length(unique(Data$trans_i)),length(unique(Data$y))),
frho_yt_1 = 0,
frho_yt_2 = 0.1,
lnsig_eps_yt = 0,
fdecor_tr=0,
fdecor_yt_tr=0)
try(dyn.unload("squid2"))
compile("squid2.cpp")
library(TMB)
compile("squid2.cpp")
install.packages("TMB", type="source")
install.packages("TMB", type = "source")
library(TMB)
install.packages('TMB', type='source')
install.packages('TMB', type='source')
install.packages('TMB')
library('TMB')
ls(2)
runExample(name="simple")
getwd()
compile("squid2.cpp")
shell("dir")
compile("test.cpp")
library("Matrix")
compile("test.cpp")
library(TMB)
compile("test.cpp")
search()
install.packages('TMB',type='source')
shell("PATH")
library(TMB)
library('TMB')
install.packages("TMB")
library('TMB')
version()
version
try(dyn.unload("test"))
compile("test.cpp")
install.packages("installr")
updateR()
library("installr")
updateR()
library("TMB")
try(dyn.unload("test"))
compile("test.cpp")
install.packages("TMB",type="source")
install.packages("TMB", type = "source")
install.packages("TMB", type = "source")
find.package("devtools")
find_rtools()
library(devtools)
find_rtools()
q()
exit()
q
library(devtools)
find_rtools()
find_rtools(TRUE)
writeLines('PATH="${RTOOLS40_HOME}\\usr\\bin;${PATH}"', con = "~/.Renviron")
Sys.which("make")
install.packages("TMB", type="source")
Sys.which("make")
library("TMB")
try(dyn.unload("test"))
compile("test.cpp")
dyn.load("test")
Data = list(i=1)
Parameters = list(p= 0)
# Make object
Obj = MakeADFun(data=Data,
parameters=Parameters,
hessian=TRUE,
DLL="test")
