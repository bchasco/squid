"eps_tr",#Latitude
"eps_y", #Year
"eps_yt")#Spatio-temporal
,
hessian=TRUE,
map=myMap,
DLL="squid2")
out <- nlminb(Obj$par,Obj$fn,Obj$gr)
rep <- Obj$report()
image(rep$eps_yt)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
Rcpp::sourceCpp('squid2.cpp')
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
estParNames
estPars
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
Rcpp::sourceCpp('squid2.cpp')
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
dim(simout)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
rep$tr_0
rep$tr_b
rep$eps_tr
rep$rho_tr
image(rep$eps_yt)
rep$theta
rep$lam
rep$ln_lam
exp(rep$ln_lam)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
exp(rep$ln_lam)
plot(rep$eps_tr)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
plot(rep$eps_tr)
exp(rep$ln_lam)
range(rep$eps_yt)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
range(rep$eps_yt)
plot(rep$eps_tr)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
rep$tr_b
plot(rep$eps_tr)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
plot(rep$eps_tr)
rep$rho_tr
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
rep$rho_tr
rep$tr_b
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
plot(rep$eps_tr)
rep$rho_tr
rep$tr_b
Data$trans_i
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
plot(rep$eps_tr)
rep$rho_tr
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
rep$tr_0
rep$tr_b
plot(rep$eps_tr)
rep$rho_tr
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
rep$rho_tr
plot(rep$eps_tr)
rep$ln_lam
Obj$gr()
image(rep$eps_yt)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
runSim <- TRUE
myMap <- list()
estNames <- list()
if(!est_tr){
myMap <- append(myMap
,map_tr)
tmpNames <- list(sig_tr=NA,
rho_tr=NA)
estNames <- append(estNames,
tmpNames)
}
if(!est_s){
myMap <- append(myMap
,map_s)
tmpNames <- list(sig_s=NA)
estNames <- append(estNames,
tmpNames)
}
if(!est_y){
myMap <- append(myMap
,map_y)
tmpNames <- list(sig_y=NA,
rho_y=NA)
estNames <- append(estNames,
tmpNames)
}
if(!est_yt){
myMap <- append(myMap
,map_yt)
tmpNames <- list(sig_yt=NA,
rho_yt_1=NA,
rho_yt_2=NA)
estNames <- append(estNames,
tmpNames)
}
myMap <- append(myMap,
list(tr_0=as.factor(NA)))
# myMap <- append(myMap
#                   ,list(ln_lam=as.factor(NA),
#                   ln_theta=as.factor(NA)))
# myMap <- append(myMap
#                 ,list(fp=as.factor(NA)))
Data <- append(Data,
list(est_tr = est_tr,
est_y = est_y,
est_s = est_s,
est_yt = est_yt))
# Make object
Obj = MakeADFun(data=Data,
parameters=Parameters,
random=c("eps_s", #Station
"eps_tr",#Latitude
"eps_y", #Year
"eps_yt")#Spatio-temporal
,
hessian=TRUE,
map=myMap,
DLL="squid2")
# Check_Identifiable(Obj)
out <- nlminb(Obj$par,Obj$fn,Obj$gr)
rep <- Obj$report()
parNames <- c("sig_s",
"sig_tr",
"sig_y",
"sig_yt",
"rho_tr",
"rho_y",
"rho_yt_1",
"rho_yt_2",
"lam",
"p",
"theta")
estPars <- c(rep$sig_eps_s,
rep$sig_eps_tr,
rep$sig_eps_y,
rep$sig_eps_yt,
rep$rho_tr,
rep$rho_y,
rep$rho_yt_1,
rep$rho_yt_2,
exp(rep$ln_lam),
rep$p,
rep$theta)
estParNames <- parNames[!(parNames%in%names(estNames))]
i <- 1
if(runSim){
myMap <- list()
simNames <- list()
if(!sim_tr){
myMap <- append(myMap
,map_tr)
tmpNames <- list(sig_tr=NA,
rho_tr=NA)
simNames <- append(simNames,
tmpNames)
}
if(!sim_s){
myMap <- append(myMap
,map_s)
tmpNames <- list(sig_s=NA)
simNames <- append(simNames,
tmpNames)
}
if(!sim_y){
myMap <- append(myMap
,map_y)
tmpNames <- list(sig_y=NA,
rho_y=NA)
simNames <- append(simNames,
tmpNames)
}
if(!sim_yt){
myMap <- append(myMap
,map_yt)
tmpNames <- list(sig_yt=NA,
rho_yt_1=NA,
rho_yt_2=NA)
simNames <- append(simNames,
tmpNames)
}
simout <- replicate(nsim,{
simData <- Obj$simulate(par = Obj$env$last.par.best, complete = TRUE)
simData$est_s <- sim_s
simData$est_y <- sim_y
simData$est_tr <- sim_tr
simData$est_yt <- sim_yt
obj2 <- MakeADFun(simData,
Parameters,
random=c("eps_s", #Station
"eps_tr",#Latitude
"eps_y", #Year
"eps_yt")#Spatio-temporal
,
hessian=TRUE,
silent = TRUE,
map=myMap,
DLL="squid2")
print(i)
i <- i+1
sim_i <- nlminb(obj2$par,obj2$fn,obj2$gr)
rep <- obj2$report()
par(mfrow=c(2,2))
plot(simData$eps_tr, ylim=c(min(simData$eps_tr,rep$eps_tr),max(simData$eps_tr,rep$eps_tr)))
lines(rep$eps_tr)
plot(simData$eps_y, ylim=c(min(simData$eps_y,rep$eps_y),max(simData$eps_y,rep$eps_y)))
lines(rep$eps_y)
hist(simData$eps_s)
hist(rep$eps_s, add=TRUE, col="red")
image(rep$eps_yt)
c(rep$sig_eps_s,
rep$sig_eps_tr,
rep$sig_eps_y,
rep$sig_eps_yt,
rep$rho_tr,
rep$rho_y,
rep$rho_yt_1,
rep$rho_yt_2,
exp(rep$ln_lam),
rep$p,
rep$theta)})
row.names(simout) <- parNames
simMelt <- melt(t(simout),measure.vars = colnames(simout),variable.name="pars")
simMelt <- simMelt[!(simMelt$Var2%in%names(simNames)),]
sim_par <- unique(simMelt$Var2)
for(ii in sim_par){
dat_q <- quantile(simMelt$value[simMelt$Var2==ii], probs=c(0.025,0.975))
simMelt <- simMelt[!(simMelt$Var2==ii & (simMelt$value<dat_q[1] | simMelt$value>=dat_q[2])),]
}
library(ggplot2)
myLines <- data.frame(Var2=parNames,
value=estPars)
myLines <- myLines[!(myLines$Var2%in%names(estNames)) |
!(myLines$Var2%in%names(simNames)),]
p <- ggplot(simMelt, aes(factor(Var2),value)) +
facet_wrap(~Var2, scales = "free") +
geom_violin(aes(factor(Var2)))+
geom_hline(aes(yintercept=value), colour="blue",myLines)
print(p)
}
save(simout,
file=paste("simout",paste(est_s,est_tr,est_y,est_yt,sep="",collapse = ""),
".out",sep=""))
myMap <- list()
simNames <- list()
if(!sim_tr){
myMap <- append(myMap
,map_tr)
tmpNames <- list(sig_tr=NA,
rho_tr=NA)
simNames <- append(simNames,
tmpNames)
}
if(!sim_s){
myMap <- append(myMap
,map_s)
tmpNames <- list(sig_s=NA)
simNames <- append(simNames,
tmpNames)
}
if(!sim_y){
myMap <- append(myMap
,map_y)
tmpNames <- list(sig_y=NA,
rho_y=NA)
simNames <- append(simNames,
tmpNames)
}
if(!sim_yt){
myMap <- append(myMap
,map_yt)
tmpNames <- list(sig_yt=NA,
rho_yt_1=NA,
rho_yt_2=NA)
simNames <- append(simNames,
tmpNames)
}
simout <- replicate(nsim,{
simData <- Obj$simulate(par = Obj$env$last.par.best, complete = TRUE)
simData$est_s <- sim_s
simData$est_y <- sim_y
simData$est_tr <- sim_tr
simData$est_yt <- sim_yt
obj2 <- MakeADFun(simData,
Parameters,
random=c("eps_s", #Station
"eps_tr",#Latitude
"eps_y", #Year
"eps_yt")#Spatio-temporal
,
hessian=TRUE,
silent = TRUE,
map=myMap,
DLL="squid2")
print(i)
i <- i+1
sim_i <- nlminb(obj2$par,obj2$fn,obj2$gr)
rep <- obj2$report()
par(mfrow=c(2,2))
plot(simData$eps_tr, ylim=c(min(simData$eps_tr,rep$eps_tr),max(simData$eps_tr,rep$eps_tr)))
lines(rep$eps_tr)
plot(simData$eps_y, ylim=c(min(simData$eps_y,rep$eps_y),max(simData$eps_y,rep$eps_y)))
lines(rep$eps_y)
hist(simData$eps_s)
hist(rep$eps_s, add=TRUE, col="red")
image(rep$eps_yt)
c(rep$sig_eps_s,
rep$sig_eps_tr,
rep$sig_eps_y,
rep$sig_eps_yt,
rep$rho_tr,
rep$rho_y,
rep$rho_yt_1,
rep$rho_yt_2,
exp(rep$ln_lam),
rep$p,
rep$theta)})
row.names(simout) <- parNames
simMelt <- melt(t(simout),measure.vars = colnames(simout),variable.name="pars")
simMelt <- simMelt[!(simMelt$Var2%in%names(simNames)),]
sim_par <- unique(simMelt$Var2)
for(ii in sim_par){
dat_q <- quantile(simMelt$value[simMelt$Var2==ii], probs=c(0.025,0.975))
simMelt <- simMelt[!(simMelt$Var2==ii & (simMelt$value<dat_q[1] | simMelt$value>=dat_q[2])),]
}
library(ggplot2)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
out <- nlminb(Obj$par,Obj$fn,Obj$gr)
# Make object
Obj = MakeADFun(data=Data,
parameters=Parameters,
random=c("eps_s", #Station
"eps_tr",#Latitude
"eps_y", #Year
"eps_yt")#Spatio-temporal
,
hessian=TRUE,
map=myMap,
DLL="squid2")
Check_Identifiable(Obj)
myMap <- append(myMap,
list(fp=as.factor(NA)))
Data <- append(Data,
list(est_tr = est_tr,
est_y = est_y,
est_s = est_s,
est_yt = est_yt))
# Make object
Obj = MakeADFun(data=Data,
parameters=Parameters,
random=c("eps_s", #Station
"eps_tr",#Latitude
"eps_y", #Year
"eps_yt")#Spatio-temporal
,
hessian=TRUE,
map=myMap,
DLL="squid2")
Check_Identifiable(Obj)
# myMap <- append(myMap,
#                 list(fp=as.factor(NA)))
myMap <- append(myMap
,list(ln_lam=as.factor(NA),
ln_theta=as.factor(NA)))
Data <- append(Data,
list(est_tr = est_tr,
est_y = est_y,
est_s = est_s,
est_yt = est_yt))
# Make object
Obj = MakeADFun(data=Data,
parameters=Parameters,
random=c("eps_s", #Station
"eps_tr",#Latitude
"eps_y", #Year
"eps_yt")#Spatio-temporal
,
hessian=TRUE,
map=myMap,
DLL="squid2")
Check_Identifiable(Obj)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
rep$rho_tr
out$par
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
out$par
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
out$par
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
out$par
exp(-0.2467)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
out$par
rep <- Obj$report()
rep$rho_yt_2
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
rep$rho_yt_2
rep$rho_yt_1
atan(0)*3.154/2
atan(10)*3.154/2
atan(10)
atan(-10)
atan(-100)
atan(100)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
rep$rho_yt_2
rep$rho_yt_1
rep$rho_y
rep$rho_r
rep$rho_tr
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
rep$rho_tr
rep$rho_yt_2
rep$rho_yt_1
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
exp(-1/(-2))
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
out$par
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
out$par
exp(-1/(0.03^2))
exp(-1/(0.3^2))
exp(-0.1/(0.03^2))
exp(-0.1/(0.3^2))
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
out$par["frho_yr"]
out$par["frho_tr"]
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
sim_i$par["frho_tr"]
sim_i$par["frho_yt_2"]
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
out$par
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
out$par
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
source('C:/NOAA/PROJECTS/squid/create_data.r', echo=TRUE)
